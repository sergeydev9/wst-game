FROM node:14-alpine
WORKDIR /app

ENV NODE_ENV=production
ENV PORT=4000

COPY dist/apps/api/package.json .
RUN npm install && \
    npm install pg@^8.6.0 # not in package.json generated by `nx build` but needed

COPY dist/apps/api/* .

EXPOSE ${PORT}
CMD [ "node", "main.js" ]
