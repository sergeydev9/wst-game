FROM node:14-alpine
WORKDIR /app

ENV NODE_ENV=production

COPY dist/apps/worker/package.json .
RUN npm install && \
    # not in package.json generated by `nx build` but needed \
    npm install pg@^8.6.0 tslib@^2.0.0 pg-format@^1.0.4

COPY dist/apps/worker/* .

CMD [ "node", "main.js" ]
